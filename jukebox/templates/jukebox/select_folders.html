{% extends "jukebox/base.html" %}

{% block title %}Hack Radio{% endblock %}   
{% block content %}

<h1>Select folders</h1>

<table id="tree" data-path="">
    <thead>
    <tr><th>Folder path</th></tr>
    </thead>
    <tbody>
        {% for root in roots %}
        <tr data-tt-id="{{ root.id }}" data-tt-branch="true">
            <td><span class="folder">{{ root.name }}</span></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript">

function toggle_folder(event) {
    folderid = $(this).parent().parent().attr('data-tt-id');
    //alert("Selecting folder " + folderid);
    $.get(Urls['jukebox:toggle_folder'](folderid), function(data){
        row = $("tr[data-tt-id="+folderid+"]");
        if (data.selected) {
            row.addClass("selected");
        } else {
            row.removeClass("selected");
        }
    });
}

function load_children(root) {
    root_id = root.id;
    $.get(Urls['jukebox:folder_subdirs'](root_id), function(data){
        rows = ""
        //alert(data.children);
        $.each(data.children, function(i, item) {
            //alert(item)
            row = 
                "<tr data-tt-id='" + item.id + "' " +
                "data-tt-parent-id='" + root_id + "' ";
            if (item.selected) {
                row += 'class="selected" ';
            }
            row += "data-tt-branch='true'>";
            row += '<td>';
            row += "<span class='folder'>" + item.name + "</span></td>"; 
            row += "</tr>";
            rows += row
        });

        table = $("#tree");
        table.treetable("loadBranch", root, rows);
    });
}

$(document).ready( function() {
    var table = $("#tree");

    table.treetable({
        expandable: true,
        initialState: "collapsed",
        onNodeCollapse: function() {
            var node = this;
            table.treetable("unloadBranch", node);
        },
        onNodeExpand: function() {
            var node = this;
            load_children(node);
        }
    });

    $(document).on("mousedown", "span.folder", toggle_folder);

//    {% for root in roots %}
//        table.treetable("expandNode", "{{ root.id }}");
//    {% endfor %}

});
</script>

{% endblock %}   
